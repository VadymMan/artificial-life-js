<canvas id="life" width="1" height="1"></canvas>
<script>
width = 800
height = 800
particleWidth = 7
particleHeight = 7
particelsCount = 200
particelsVelocityReduce = 0.5
forceRange = 80
//gForce = -0.1

m = document.getElementById("life").getContext('2d')

setCanvasSize = () => {
	m.canvas.width = width
	m.canvas.height = height
}

draw = (x, y, c, w, h) => {
	m.fillStyle = c
	m.fillRect(x, y, w, h)
}

particles = []
particle = (x, y, c) => {
	return { "x" : x, "y" : y, "vx" : 0, "vy" : 0, "color" : c }
}

randomStartPoint = (border) => {
	return Math.random() * (border - 100) + 50
}

create = (number, color) => {
	group = []
	for (let i = 0; i < number; i++) {
		group.push(particle(randomStartPoint(width), randomStartPoint(height), color))
		particles.push(group[i])
	}
	return group
}

rule = (particles1, particles2, g) => {
	for(let i = 0; i < particles1.length; i++) {
		fx = 0 // init force for x dimension
		fy = 0 // init force for y dimension
		for(let j = 0; j < particles2.length; j++) {
			a = particles1[i] // particle a
			b = particles2[j] // particle b
			dx = a.x - b.x
			dy = a.y - b.y
			d = Math.sqrt(dx * dx + dy * dy) // distance between particles a and b
			if (d > 0 && d < forceRange) {
				F = g * 1/d // attraction force by gravity law with all particles mass = 1
				// todo1: fix fx and fy, when they have invalid number sign 
				fx += (F * dx)
				fy += (F * dy)	
			}

		}
			a.vx = (a.vx + fx) * particelsVelocityReduce // particle velocity applied by attraction force 
			a.vy = (a.vy + fy) * particelsVelocityReduce
			
			// todo1: remove 
			if (a.x <= 0) {
				if (a.vx < 0) {
					a.vx *= -1
				}
			}
			if (a.x >= width) {
				if (a.vx > 0) {
					a.vx *= -1
				}
			}

			if (a.y <= 0) {
				if (a.vy < 0) {
					a.vy *= -1
				}
			}
			if (a.y >= height) {
				if (a.vy > 0) {
					a.vy *= -1
				}
			}

			a.x += a.vx
			a.y += a.vy

	}
}

yellow = create(particelsCount, "yellow")
red = create(particelsCount, "red")
green = create(particelsCount, "green")

update = () => {
	rule(green, green, -0.32)
	rule(green, red, -0.17)
	rule(green, yellow, 0.34)
	rule(red, red, 0.10)
	rule(red, green, -0.34)
	rule(yellow, yellow, 0.15)
	rule(yellow, green, -0.20)
	m.clearRect(0, 0, width, height)
	draw(0, 0, "black", width, height)
	for (i = 0; i < particles.length; i++) {
		draw(particles[i].x, particles[i].y,
			particles[i].color, particleWidth, particleHeight)
	}
	requestAnimationFrame(update)
}

setCanvasSize();
update();
</script>
